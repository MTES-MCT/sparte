{% load crispy_forms_tags %}

{% if form %}
    <div class="fr-mt-4w">
        <form hx-post="{% url 'project:trajectory:partial-form-consumption' project.pk %}" hx-swap="outerHTML">
            <div class="fr-grid-row form-set-year-conso">
                {% csrf_token %}
                {{ form|crispy }}
            </div>
            <button class="fr-btn mt-2" type="submit">Afficher la trajectoire</button>
        </form>
    </div>
{% else %}
    <button class="fr-btn fr-btn fr-btn--sm fr-mr-2w" data-bs-toggle="modal" data-bs-target="#setTrajectory" aria-hidden="true" hx-get="{% url 'project:trajectory:partial-form-period' project.pk %}" hx-target="#setTrajectoryForm">Sélectionnez la période de la trajectoire</button>
{% endif %}

{% if success_message %}
    {% load highcharts_tags %}

    <div id="trajectory-chart-swapper" hx-swap-oob="true">
        <div class="fr-mt-7w">
            <div class="border fr-p-2w">
                <div class="d-flex justify-content-end align-items-center fr-mb-2w">
                    <button class="fr-btn fr-btn fr-btn--sm fr-mr-2w" data-bs-toggle="modal" data-bs-target="#setTrajectory" aria-hidden="true" hx-get="{% url 'project:trajectory:partial-form-period' project.pk %}" hx-target="#setTrajectoryForm">Modifier la période de la trajectoire</button>

                    <div class="dropdown custom-dropdown fr-mr-2w" data-toggle="tooltip" title="Exporter le graphique">
                        <button class="fr-btn fr-icon-download-line fr-btn--tertiary fr-btn--sm" data-bs-toggle="dropdown" aria-expanded="false"></button>

                        <ul class="dropdown-menu">
                            <li>
                                <a class="fr-nav__link export-chart" href="#" data-chart-target="objective_chart" data-type="image/png">PNG</a>
                            </li>
                            <li>
                                <a class="fr-nav__link export-chart" href="#" data-chart-target="objective_chart" data-type="image/jpeg">JPEG</a>
                            </li>
                            <li>
                                <a class="fr-nav__link export-chart" href="#" data-chart-target="objective_chart" data-type="application/pdf">PDF</a>
                            </li>
                            <li>
                                <a class="fr-nav__link export-chart" href="#" data-chart-target="objective_chart" data-type="image/svg+xml">Vectoriel</a>
                            </li>
                        </ul>
                    </div>

                    <button class="fr-btn fr-icon-drag-move-2-line fr-btn--tertiary fr-btn--sm fullscreen-chart" data-chart-target="objective_chart" data-toggle="tooltip" title="Afficher le graphique en plein écran"></button>
                </div>

                <div id="trajectory_chart"></div>
                {% display_chart 'trajectory_chart' trajectory_chart CSP_NONCE %}
            </div>
        </div>
    </div>
{% endif %}
