{% load crispy_forms_tags %}

{% if success_message %}
    <div class="fade-in fr-alert fr-alert--success fr-alert--sm" role="alert">
        <h3 class="fr-alert__title">Votre seuil de réduction à 2031 a été mis à jour.</h3>
    </div>

    <script language="javascript" nonce="[NONE_PLACEHOLDER]">
        setTimeout(() => {
            const modal = bootstrap.Modal.getInstance(document.getElementById("setTarget"))
            if (modal)
                modal.hide()
        }, 1800)

        _paq.push(['trackEvent', 'north_star_activation_funnel', 'target_2031_updated', 'target_2031_form_success'])
    </script>
{% else %}
    <form hx-post="{% url 'project:trajectory:set_target_2031' diagnostic.pk %}" hx-ext="disable-element" hx-disable-element="#set_target_2031_btn">
        {% csrf_token %}
        {{ form|crispy }}
        <ul class="fr-btns-group fr-btns-group--right fr-btns-group--inline-lg fr-mt-2w">
            <li>
                <button id="set_target_2031_btn" class="fr-btn position-relative" type="submit"><span class="htmx-indicator-placeholder">Enregistrer</span><div class="fr-custom-loader--button htmx-indicator"></div></button>
            </li>
        </ul>
    </form>

    <script language="javascript" nonce="[NONE_PLACEHOLDER]">
        document.getElementById("set_target_2031_btn").onclick = function() {
            _paq.push(['trackEvent', 'north_star_activation_funnel', 'click_button_save_target_2031', 'save_target_2031_button_clicked'])
        }
    </script>
{% endif %}
