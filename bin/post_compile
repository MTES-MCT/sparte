#!/bin/sh

# required to collect static within the container used for serving the app

echo "python=$(python --version)"
echo "django=$(python -m django --version)"

# export PYTHONPATH=/build/${REQUEST_ID}/.apt/usr/lib/python3/dist-packages/:${PYTHONPATH}
export LD_LIBRARY_PATH=/build/${REQUEST_ID}/.apt/usr/lib/x86_64-linux-gnu/blas/:/build/${REQUEST_ID}/.apt/usr/lib/x86_64-linux-gnu/lapack/:${LD_LIBRARY_PATH}
export PROJ_LIB=/build/${REQUEST_ID}/.apt/usr/share/proj

# collect static
python manage.py collectstatic --noinput

# clear cache
python manage.py clear_cache

# Deactivating maintenance mode
# v4.4 has a long data migration manually run
python manage.py maintenance --off
