{% extends 'index.html' %}

{% load crispy_forms_tags %}
{% load static %}
{% load project_tags %}
{% load humanize %}
{% load i18n %}
{% load l10n %}
{% load sri %}

{% block pagetitle %}
Modifier
{% endblock %}

{% block headers %}
{% sri_static "project/css/project.css" %}
<style nonce="{{ CSP_NONCE }}">
form > div {
    margin-top: 30px;
    padding: 3px;
}
.div_highlight {
    background-color: rgba(255,0,0,0.2);
}
#hint_id_is_public{
    display: block;
    width: 100%;
}
</style>
{% endblock %}


{% block content %}
<div class="px-4">
    {% include "project/partials/report_title.html" with title=diagnostic surface=diagnostic.area %}

    {% include "project/detail_menu.html" %}

    <div class="d-flex flex-column h-100 w-100 align-items-center justify-content-center">
        <div class="col-lg-6 col-md-8 col-12">
            <h2>Mettre à jour {{ project.name }}</h2>
    
            <form action="" method="post">
                {% csrf_token %}
                {{ form|crispy }}
                <button class="fr-btn mt-4" type="submit">Mettre à jour</button>
                <a href="{% url 'project:detail' project.pk %}" class="fr-btn fr-btn--secondary mt-1">Annuler</a><li class="list-inline-item">
                <a href="{% url 'project:delete' project.pk %}">
                    <i class="bi bi-trash"></i> Supprimer
                </a>
                </li>
            </form>
        </div>
    </div>

    <div class="box p-4 mt-1 flex-grow-1">
        <div  class="fw-bold">
            <a class="float-end" href="{% url 'project:lookalike' project.id %}">
                <i class="bi bi-plus-circle"></i>
            </a>
            Territoires de comparaison
        </div>
        {% if project.look_a_like %}
            <div class="d-flex flex-column mt-2">
            {% for land in project.get_look_a_like %}
                <div class="w100">
                    {{ land.name }}
                    <a href="{% url 'project:lookalike' project.id %}?remove={{ land.public_key }}&next={% url 'project:update' project.id %}" class="float-end"><i class="bi bi-trash text-danger"></i></a>
                </div>
            {% endfor %}
            </div>
        {% else %}
        <p class="text-muted">Aucun territoire.</p>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block bodyend %}
<script language="javascript">
const queryString = window.location.search
const urlParams = new URLSearchParams(queryString)
const next = urlParams.get('next')
if (next == "report-target-2031"){
    console.log("hello world")
    $('#div_id_target_2031').addClass("div_highlight")
}
</script>
{% endblock bodyend %}

{% block tagging %}
<script language="javascript" nonce="{{ CSP_NONCE }}">
$( window ).on('load', function () {
    _paq.push(['trackEvent', 'Consultation diagnostic', 'Tableau de bord', 'Synthèse'])
})

var fired = false
$( window ).scroll(function() {
    if(fired == false && $( window ).scrollTop() + $( window ).height() > $( "#block-content" ).height() - 100) {
        _paq.push(['trackEvent', 'Consultation diagnostic', 'Fin tableau de bord', 'Synthèse'])
        fired = true
    }
})
</script>
{% endblock tagging %}
