{% load highcharts_tags %}
{% load project_tags %}
{% load sri %}

<div>
    <h3 id="determinants-conso">Comparaison logements vacants et autorisations de construction de logements</h3>

    <div class="fr-grid-row fr-grid-row--gutters">
        <div class="fr-col-12">
            <div class="bg-white fr-p-2w">
                <div class="d-flex justify-content-end align-items-center fr-mb-2w">
                    {% include "project/components/widgets/chart_buttons.html" with chart="logement_vacant_autorisation_construction_comparison_chart" show_fullscreen=false %}
                    <button class="fr-btn fr-icon-question-line fr-btn--tertiary fr-btn--sm" data-bs-toggle="modal" data-bs-target="#densityModal" data-toggle="tooltip" title="Astuces pour lire le graphique"></button>
                </div>
                <div id="logement_vacant_autorisation_construction_comparison_chart"></div>
            </div>
        </div>
    </div>

    <div class="fr-grid-row fr-grid-row--gutters">
        <div class="fr-col-12 fr-col-lg-6">
            <div class="bg-white fr-p-2w h-100">
                <div class="d-flex justify-content-end align-items-center fr-mb-2w">
                    {% include "project/components/widgets/chart_buttons.html" with chart="logement_vacant_autorisation_construction_ratio_gauge_chart" show_fullscreen=false %}
                    <button class="fr-btn fr-icon-question-line fr-btn--tertiary fr-btn--sm" data-bs-toggle="modal" data-bs-target="#densityModal" data-toggle="tooltip" title="Astuces pour lire le graphique"></button>
                </div>
                <div id="logement_vacant_autorisation_construction_ratio_gauge_chart"></div>
            </div>
        </div>
        <div class="fr-col-12 fr-col-lg-6">
            <div class="guide-container guide-container--column h-100">
                <svg  class="guide-icon" version="1.0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="fill: #48d5a7;"><path d="M247.5 4.5c-3 2.9-3.2 6.4-.4 9.8l2 2.7 109.7.2 109.7.3 5.3 2.2c10.8 4.4 18.7 13.5 21.7 24.8 1.2 4.9 1.5 13.8 1.5 53.8v47.8l2.6 2.6c2 2 3.1 2.4 5.7 1.9 6.9-1.3 6.7.6 6.7-53.7 0-31.3-.4-50.7-1.1-54.1-3.9-19-20.7-35.8-39.7-39.7C467.6 2.3 432 2 357.9 2h-108zm-29 .8c-9.6 3.8-18.2 10.5-23.6 18.4l-3 4.3-74.7.2-74.7.3-5.1 2.7C30.9 34.6 24 42.3 21.7 48.6c-1.6 4.6-1.7 13.5-1.5 149.9l.3 145 2.7 5.1c1.5 2.8 4.9 7.1 7.6 9.5l4.8 4.3-17.5 27C3.1 412.6.6 417 .3 420.9c-.4 5.2 2.3 11 6.9 14.4 3.7 2.8 11.6 3.4 15.8 1.2 1.8-.9 23.7-17.2 48.7-36.1 39.3-29.8 45.8-34.4 48.8-34.4h3.5v34.8c0 34.6 0 34.9 2.3 39.3 1.3 2.4 4.3 5.7 6.6 7.4l4.3 3 89.8.3 89.7.2 12.4 26.8c6.8 14.7 13.5 27.9 15 29.4 5 5.1 11 4.9 16.6-.7l3.3-3.3V451h7.3c8.6 0 13.8-2.1 18.4-7.3 1.8-2 3.7-5.3 4.2-7.4.7-2.5 1.1-25.8 1.1-66.5v-62.7l39.8 30.2c21.8 16.5 41.3 30.9 43.2 31.9 7.3 3.8 16.6.6 20.8-7.3s3.5-9.7-14.8-37.9c-8.9-13.8-16.1-25.2-15.9-25.4s3.1-1.1 6.4-2.1c16.4-4.7 28-15.4 34.6-32 2.4-6 2.4-6.3 2.7-49.7l.3-43.8-2.5-2.5c-3-3-6.4-3.2-9.9-.5l-2.6 2.1-.3 42.7-.3 42.7-3.1 6.5c-3.8 8-10.1 14.5-17.4 17.9l-5.5 2.6-119 .3c-65.5.1-120.5 0-122.2-.3l-3.3-.6-.2-115.2c-.3-109.8-.4-115.4-2.2-119.2-2.4-5.3-7.9-12-11.6-14.2-1.7-.9-3-2.1-3-2.6 0-1.7 6.8-7 13.2-10.3 4.9-2.5 6.9-4.1 7.4-5.9 1-3.9-.4-7.3-3.6-9-3.4-1.7-3.5-1.7-7.5-.2m-18.2 39.1c4.2 1.7 8.3 6.6 9.7 11.4 1.4 5.1 1.4 277.3 0 282.4-1.4 4.8-5.5 9.7-9.7 11.4-2.6 1.1-17 1.4-77.6 1.4H48.4l-4.4-2.3c-3-1.4-5.3-3.6-6.7-6.2l-2.3-4v-283l2.3-4c1.4-2.6 3.7-4.8 6.7-6.3l4.4-2.2h74.3c60.6 0 75 .3 77.6 1.4M308.6 299H379v67.5c0 65.6-.1 67.5-1.9 68.5-1.3.7-39.9 1-117.8 1-103.2 0-116.1-.2-118.1-1.6-2.2-1.5-2.2-1.5-2.2-35V366h30.5c28.7 0 30.8-.1 36.2-2.1 9.8-3.7 18-13.9 19.8-24.7l.7-4.2H288c60.9 0 61.8 0 64.4-2.1 3.4-2.7 3.6-7.9.4-10.9-2.1-2-3.2-2-64.5-2H226v-22.3l6.1.7c3.4.3 37.9.6 76.5.6M465 322.7c8.5 13.1 16.5 25.5 17.8 27.6 3.1 4.7 2.4 5.6-2 2.5-3.1-2.1-52.8-39.7-65.5-49.6l-5.5-4.2h39.9zM88 368.8c-18.5 14.7-71.6 53.9-71.8 53.2-.2-.6 7-12.4 16-26.2 8.9-13.8 17-26.1 17.8-27.4 1.5-2.4 1.5-2.4 21.5-2.4h20zm261 98.4c0 8.9-.2 15.9-.4 15.7-.6-.5-14.6-30.9-14.6-31.5 0-.2 3.4-.4 7.5-.4h7.5z"/><path d="M72 129.5c-7.5 2.2-13.6 5.9-17 10.6-5.7 7.9-4.6 16.6 2.3 18.8 4.6 1.5 7.4.3 11.6-4.9 4-4.9 8.3-7 14.7-7 9.7 0 15 4.8 14.1 12.8-.5 4.4-1.1 5.2-10.6 14.2-10.8 10.2-13.3 14.3-14.6 23.6-.8 6.2.8 13 3.5 14.4 4 2.1 12.1.7 14.2-2.4.4-.6.8-2.9.8-5.1 0-8.4 1.7-11.4 11.5-20.8 10.9-10.4 15.4-17.8 16.2-26.6 1-11.1-6.4-21.6-18.6-26.2-7.4-2.8-20.6-3.5-28.1-1.4m75 0c-14.6 4.1-23.7 15.5-19.9 24.6 1.4 3.6 6.6 6.3 10.3 5.3 1.4-.3 4.3-2.7 6.5-5.4 4.8-5.7 9.1-7.4 16.6-6.8 6.7.6 11.2 3.7 12.1 8.3 1.1 6.2-.3 8.6-10.6 18.5-10.9 10.4-13.3 14.5-14.5 24.2-.8 6.5.7 12.3 3.5 13.8 4 2.1 12.1.7 14.2-2.4.4-.6.8-2.9.8-5.1 0-8.3 1.6-11.1 12.4-21.8 12.4-12.4 15-17 15-27.2 0-5.3-.5-8-2.1-11.1-3-5.6-9.4-10.9-16.2-13.5-7.4-2.8-20.6-3.4-28.1-1.4m-73.6 98.8c-6.4 5.8-5.5 15.2 1.9 19.7 8 4.9 18.7-.9 18.7-10.2 0-7.9-4.9-12.8-13-12.8-3.2 0-4.8.7-7.6 3.3m76.4-1.5c-5.6 3.4-7.3 11.2-3.8 16.9 3.8 6.3 11.2 8 17.1 4 5.8-3.9 7.6-10.6 4.4-16.7-2.9-5.7-12-7.8-17.7-4.2m15.3 149.8c-1.2 1.5-2.1 3.3-2.1 4 0 2.6 2.3 6.2 4.7 7.3 1.7.8 20.4 1.1 61.8 1.1h59.4l2.7-2.3c3.3-2.8 3.7-7.6.9-10.7-1.8-2-2.9-2-63.6-2h-61.8zM312 376c-2.5 2.5-2.6 7.1-.1 10.1 1.9 2.3 2.4 2.4 20 2.7l18.1.3 2.5-2.5c3.1-3.1 3.3-7.8.5-10.6-1.9-1.9-3.3-2-20.5-2s-18.6.1-20.5 2m20.9-341.6c-11.5 4.1-19.2 15.1-19.3 27.6 0 8.1 1.5 12.7 6.4 18.9 5.7 7.1 13.2 10.6 23 10.6 9 0 14.9-2.4 20.7-8.2 12.3-12.3 11.7-31.8-1.3-43.2-2.5-2.2-6.6-4.7-9.1-5.5-5.6-1.9-15.4-2-20.4-.2m16.7 15.2c9.4 4.5 9.9 19.1.8 25-3.5 2.3-11.3 2.3-14.8 0-4-2.6-6.6-7.5-6.6-12.5 0-10.7 10.7-17.2 20.6-12.5m-36.7 52.7c-5.6 3.7-6.9 7.6-6.9 20.5 0 7.3.5 12.4 1.4 14.6 1.5 3.5 6.3 7.6 9 7.6 1.4 0 1.6 3.8 1.6 37.5 0 37.1 0 37.5-2 37.5-2.9 0-7 2.3-10 5.5-2.4 2.5-2.5 3.3-2.8 17-.4 15.9.4 19.2 5.6 23 2.6 1.9 4.5 2 38.7 2.3 32.8.2 36.3.1 39.4-1.5 6.3-3.3 7.5-6.1 7.9-18.4.3-6 .1-12.9-.2-15.4-1-6.1-5.8-11.2-11.4-12.1l-4.2-.7v-55.6c0-53.8-.1-55.7-2-58.9-1.1-1.8-3.2-3.7-4.6-4.2-1.4-.6-14.3-1-29.3-1-26.2 0-26.9.1-30.2 2.3m51.1 68.8c0 39.3.3 56.7 1.1 58.2 1.9 3.8 5.2 5.7 9.7 5.7h4.2v18h-61v-18h3.1c4 0 8.2-2.5 10.5-6.4 1.8-2.9 1.9-5.7 1.9-45.6 0-48.5.2-47.5-8.1-51.1l-4.4-2V115h43z"/></svg>
                <div class="guide-content">
                    <div class="guide-title">Comprendre les données</div>
                    <div class="guide-description">
                        <p class="fr-text--sm">
                            En {{ autorisation_logement_last_year.year|stringformat:"i" }}, sur le territoire de {{ project.territory_name }}, 
                            <strong>
                                {{ autorisation_logement_last_year.logements_autorises }} 
                                {% if autorisation_logement_last_year.logements_autorises < 2 %}
                                autorisation de construction de logement a été autoriseé 
                                {% else %}
                                autorisations de construction de logements ont été autorisées, 
                                {% endif %}
                            </strong>
                            ce qui correspond à une augmentation de {{ autorisation_logement_last_year.percent_autorises_on_parc_general|smart_round }}% de son parc de logements total.
                        </p>
                        <p class="fr-text--sm">
                            Au 1er janvier de cette même année, sur le territoire de {{ project.territory_name }}, 
                            <strong>{{ logement_vacant_last_year.logements_vacants_parc_prive }} logement{{ logement_vacant_last_year.logements_vacants_parc_prive|pluralize }} du parc privé (soit {{ logement_vacant_last_year.logements_vacants_parc_prive_percent|smart_round }}% du parc de logements privé)</strong> 
                            {% if logement_vacant_last_year.logements_vacants_parc_prive < 2 %}
                            était vacant, 
                            {% else %}
                            étaient vacants  
                            {% endif %}
                            depuis plus de 2 ans,
                            et <strong>{{ logement_vacant_last_year.logements_vacants_parc_social }} logement{{ logement_vacant_last_year.logements_vacants_parc_social|pluralize }} du parc des bailleurs sociaux (soit {{ logement_vacant_last_year.logements_vacants_parc_social_percent|smart_round }}% du parc de logements des bailleurs sociaux)</strong> 
                            {% if logement_vacant_last_year.logements_vacants_parc_social < 2 %}
                            était vacant 
                            {% else %}
                            étaient vacants 
                            {% endif %}
                            depuis plus de 3 mois.
                        </p>
                        <p class="fr-text--sm"> 
                            Sur le territoire de {{ project.territory_name }}, le nombre de logements vacants représente donc, en proportion, {{ autorisation_logement_last_year.percent_autorises_on_vacants_parc_general|smart_round }}% du nombre d'autorisations de construction de logements.
                            {% if autorisation_logement_last_year.percent_autorises_on_vacants_parc_general > 100 %}
                            Autrement dit, il y a {{ autorisation_logement_last_year.percent_autorises_on_vacants_parc_general|divide_by:100|smart_round}} fois plus de logements vacants que d'autorisations de construction de logement.
                            {% elif autorisation_logement_last_year.percent_autorises_on_vacants_parc_general == 100 %}
                            Autrement dit, il y a autant de logements vacants que d'autorisations de construction de logement.
                            {% else %}
                            Autrement dit, il y a {{ 100|divide_by:autorisation_logement_last_year.percent_autorises_on_vacants_parc_general|smart_round }} fois moins de logements vacants que d'autorisations de construction de logement.
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="fr-mt-5w">
    <h3 id="conso-annuelle"></h3>

    <div class="fr-grid-row fr-grid-row--gutters">
        <div class="fr-col-12">
            <div class="bg-white fr-p-2w h-100">
                <div class="d-flex justify-content-end align-items-center fr-mb-2w">
                    {% include "project/components/widgets/chart_buttons.html" with chart="logement_vacant_conso_progression_chart" show_fullscreen=True %}
                    {% comment %} <button class="fr-btn fr-icon-question-line fr-btn--tertiary fr-btn--sm" data-bs-toggle="modal" data-bs-target="#consoAnnuelle" data-toggle="tooltip" title="Astuces pour lire le graphique"></button> {% endcomment %}
                </div>
                <div id="logement_vacant_conso_progression_chart"></div>
            </div>
        </div>
    </div>
</div>

<div class="fr-mt-5w">
    <h3 id="conso-annuelle"></h3>

    <div class="fr-grid-row fr-grid-row--gutters">
        <div class="fr-col-12">
            <div class="bg-white fr-p-2w h-100">
                <div class="d-flex justify-content-end align-items-center fr-mb-2w">
                    {% include "project/components/widgets/chart_buttons.html" with chart="logement_vacant_ratio_progression_chart" show_fullscreen=True %}
                    {% comment %} <button class="fr-btn fr-icon-question-line fr-btn--tertiary fr-btn--sm" data-bs-toggle="modal" data-bs-target="#consoAnnuelle" data-toggle="tooltip" title="Astuces pour lire le graphique"></button> {% endcomment %}
                </div>
                <div id="logement_vacant_ratio_progression_chart"></div>
            </div>
        </div>
    </div>
</div>

<div class="fr-mt-5w">
    <h3 id="conso-annuelle"></h3>

    <div class="fr-grid-row fr-grid-row--gutters">
        <div class="fr-col-12">
            <div class="bg-white fr-p-2w h-100">
                <div class="d-flex justify-content-end align-items-center fr-mb-2w">
                    {% include "project/components/widgets/chart_buttons.html" with chart="logement_vacant_autorisation_logement_ratio_progression_chart" show_fullscreen=True %}
                    {% comment %} <button class="fr-btn fr-icon-question-line fr-btn--tertiary fr-btn--sm" data-bs-toggle="modal" data-bs-target="#consoAnnuelle" data-toggle="tooltip" title="Astuces pour lire le graphique"></button> {% endcomment %}
                </div>
                <div id="logement_vacant_autorisation_logement_ratio_progression_chart"></div>
            </div>
        </div>
    </div>
</div>

{% display_chart_data 'logement_vacant_autorisation_construction_comparison_chart' logement_vacant_autorisation_construction_comparison_chart CSP_NONCE %}
{% display_chart_data 'logement_vacant_autorisation_construction_ratio_gauge_chart' logement_vacant_autorisation_construction_ratio_gauge_chart CSP_NONCE %}
{% display_chart_data 'logement_vacant_autorisation_logement_ratio_progression_chart' logement_vacant_autorisation_logement_ratio_progression_chart CSP_NONCE %}
{% display_chart_data 'logement_vacant_ratio_progression_chart' logement_vacant_ratio_progression_chart CSP_NONCE %}
{% display_chart_data 'logement_vacant_conso_progression_chart' logement_vacant_conso_progression_chart CSP_NONCE %}
