{% extends 'index.html' %}

{% load static %}
{% load crispy_forms_tags %}
{% load project_tags %}
{% load sri %}

{% block pagetitle %}
SPARTE
{% endblock %}

{% block headers %}
{% sri_static "project/css/project.css" %}
{% endblock %}


{% block content %}
<div class="fr-container">
  <div class="fr-grid-row fr-grid-row--gutters">
    <div class="fr-col-8">
      <h1 class="fr-mb-2w">{{ project.name }}</h1>
      <p class="fr-h6">Surface du territoire : {{ total_surface|floatformat:0 }} ha</p>
    </div>
    <div class="fr-col-4">
      <a href="{% url 'project:report_download' project.pk %}" class="fr-btn float-end">Télécharger mon diagnostic [word]</a>
    </div>
  </div>

  <nav>
    <ul class="navigation-secondary fr-mb-5w">
      <li class="active"><a href="#">Synthese</a></li>
      <li><a href="#">Carte interactive</a></li>
      <li><a href="#">Consommation</a></li>
      <li><a href="#">Artificialisation</a></li>
      <li><a href="#">Usage</a></li>
      <li><a href="#">Couverture</a></li>
    </ul>
  </nav>

  <div class="fr-grid-row fr-grid-row--gutters">
    <div class="fr-col-4">
      <div class="bg-color-grey fr-p-3w fr-mb-3w">
        <a class="fr-link fr-link--sm float-end" href="{% url 'project:update' project.pk %}">Modifier</a>
        <p class="fr-mb-0"><b>Titre du diagnostic</b></p>
        <p>{{ project.name }}</p>


        <p class="fr-mb-0"><b>Période demandée</b></p>
        <p>De {{ project.analyse_start_date }} à {{ project.analyse_end_date }}</p>
        <p class="fr-mb-0"><b>Maille d'analyse</b></p>
        <p>-</p>
        <hr>

        <p class="fr-mb-0"><b>Millésimes OCSGE utilisés</b></p>
        <p>Le plus ancien : {{ project.first_year_ocsge|stringformat:"i" }}
        <br/>Le plus récent : {{ project.last_year_ocsge|stringformat:"i" }}</p>

        <hr>
        <a class="fr-link fr-link--sm float-end" href="{% url 'project:lookalike' project.id %}">Modifier</a>
        <p class="fr-mb-0"><b>Territoires de comparaison</b></p>

        {% if project.look_a_like %}
            <div class="d-flex flex-column mt-2">
            {% for land in project.get_look_a_like %}
                <div class="w100">
                    {{ land.name }}
                    <a href="{% url 'project:lookalike' project.id %}?remove={{ land.public_key }}" class="float-end"><i class="bi bi-trash text-danger"></i></a>
                </div>
            {% endfor %}
            </div>
        {% else %}
        <p class="text-muted">Aucun territoire.</p>
        {% endif %}
      </div>

      {% if user.is_authenticated %}
        <a class="fr-link" href="{% url 'project:delete' project.pk %}"><i class="bi bi-trash"></i> Supprimer</a>
      {% endif %}
    </div>


    <div class="fr-col-8">
      {% if claim_diagnostic %}
        <div class="fr-notice fr-notice--info fr-mb-2w">
          <div class="fr-container">
              <div class="fr-notice__body">
                  <!-- <p class="fr-notice__title">Label titre du bandeau d'information importante, avec un texte assez long, et un <a href='#' rel='noopener' target='_blank'>lien au fil du texte</a> lorem ipsum dolor sit lorem ipsum dolor sit.</p> -->

                  {% if user.is_authenticated %}
                    <p class="fr-notice__title">Le diagnostic n'est pas associé à votre compte, vous ne pourrez pas le retrouver lors de votre prochaine visite. Pour corriger cela :
                      <a href="{% url 'project:claim' project.id %}">associez le diagnostic à votre compte</a>
                    </p>
                  {% else %}
                    <p class="fr-notice__title">Vous êtes actuellement en mode "anonyme", pour reprendre votre travail lors de votre prochaine visite, vous serez obligé de recréer votre diagnostic (nom, description, territoires de comparaison et groupes de communes auront disparus). Vous pouvez créer un compte et ainsi conserver vos diagnostics et leur configuration. Vous pourrez également les partager avec d'autres utilisateurs.
                        <a href="{% url 'users:signup' %}?next={% url 'project:claim' project.id %}">Créer un compte</a> (ou <a href="{% url 'users:signin' %}?next={% url 'project:claim' project.id %}">connectez vous</a>)
                    </p>
                  {% endif %}
                  <button class="fr-btn--close fr-btn" title="Masquer le message" onclick="const notice = this.parentNode.parentNode.parentNode; notice.parentNode.removeChild(notice)">
                      Masquer le message
                  </button>
              </div>
          </div>
        </div>
      {% endif %}

      <h2>Consommation</h2>
      <h3>Bilan de la consommation d'espace</h3>
      <a href="{% url 'project:report_conso' project.pk %}">Consulter le bilan de la consommation d'espace</a>
    </div>

</div>




<!-- <div class="row w-100 justify-content-center"> -->
    <!-- <ul class="list-inline text-center">
        <li class="list-inline-item">
            <a href="{% url 'project:update' project.pk %}">
                <i class="bi bi-pencil"></i> Editer
            </a>
        </li>
        {% if user.is_authenticated %}
        <li class="list-inline-item">
            <a href="{% url 'project:delete' project.pk %}">
                <i class="bi bi-trash"></i> Supprimer
            </a>
        </li>
        {% endif %}
    </ul> -->

    <!-- <div class="col-8 bg-light p-3 rounded-5 border mt-1">
        <h1 class="mb-5">{{ project.name }}</h1>

        {% if claim_diagnostic %}
            <div class="alert alert-warning fade show mb-5" role="alert">
            {% if user.is_authenticated %}
                Le diagnostic n'est pas associé à votre compte, vous ne pourrez pas le retrouver lors de votre prochaine visite. Pour corriger cela :
                <a href="{% url 'project:claim' project.id %}" class="fr-btn ms-5">Associer le diagnostic à votre compte</a>
            {% else %}
                Vous êtes actuellement en mode "anonyme", pour reprendre votre travail lors de votre prochaine visite, vous serez obligé de recréer votre diagnostic (nom, description, territoires de comparaison et groupes de communes auront disparus). Vous pouvez créer un compte et ainsi conserver vos diagnostics et leur configuration. Vous pourrez également les partager avec d'autres utilisateurs.
                <a href="{% url 'users:signup' %}?next={% url 'project:claim' project.id %}" class="fr-btn ms-5">Créer un compte</a> (ou <a href="{% url 'users:signin' %}?next={% url 'project:claim' project.id %}" class="">connectez vous</a>)
            {% endif %}
            </div>
        {% endif %}

        <div class="row gx-2">
            <div class="col">
                <div class="d-flex flex-column box mt-0 p-4 justify-content-center h-100">
                    <div class="text-center">
                        <a href="{% url 'project:map' project.pk %}" data-toggle="tooltip" title="Carte intéractive">
                            <i class="bi bi-map"></i>
                            <br/><strong>Carte interactive</strong>
                        </a>
                    </div>
                    <div class="mt-2">
                        <ul class="list-unstyled">
                            <li><i class="bi bi-arrow-right-short"></i>Zones artificielles</li>
                            <li><i class="bi bi-arrow-right-short"></i>Zones artificialisées et renaturées sur la période</li>
                        </ul>
                    </div>
                    <ul>
                        <li><a href="{% url 'project:theme-my-artif' project.pk %}">Comprendre L'évolution de l'artificialisation de mon territoire</a></li>
                        <li><a href="{% url 'project:theme-city-conso' project.pk %}">Consommation des communes de mon territoire</a></li>
                        <li><a href="{% url 'project:theme-city-artif' project.pk %}">Artificialisation des communes de mon territoire</a></li>
                    </ul>
                </div>
            </div>
            <div class="col">
                <div class="d-flex flex-column box mt-0 p-4 justify-content-center h-100">
                    <div class="text-center">
                        <a href="{% url 'project:report_synthesis' project.pk %}" data-toggle="tooltip" title="Rapports" class="me-1">
                            <i class="bi bi-graph-down"></i>
                            <br/><strong>Tableau de bord</strong>
                        </a>
                    </div>
                    <div class="mt-2">
                        <ul class="list-unstyled">
                            <li><i class="bi bi-arrow-right-short"></i>Trajectoire ZAN en 2031 et 2050</li>
                            <li><i class="bi bi-arrow-right-short"></i>Bilan sur la période sélectionnée</li>
                            <li><i class="bi bi-arrow-right-short"></i>Évolution sur la période sélectionnée</li>
                            <li><i class="bi bi-arrow-right-short"></i>Comparaison au territoire supérieur</li>
                            <li><i class="bi bi-arrow-right-short"></i>Déterminants (Habitat, activité...)</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="d-flex flex-column box mt-0 p-4 justify-content-center h-100">
                    <div class="text-center">
                        <a href="{% url 'project:report_download' project.pk %}" data-toggle="tooltip" title="Télécharger le bilan du territoire">
                            <i class="bi bi-download"></i>
                            <br/><strong>Bilan téléchargeable</strong>
                        </a>
                    </div>
                    <div class="mt-2">
                        <ul class="list-unstyled">
                            <li><i class="bi bi-arrow-right-short"></i>synthèse du diagnostic de votre territoire</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>


        <div class="row gx-1">
            <div class="col-5 d-flex flex-column">

                <div class="box p-4">
                    <a class="float-end" href="{% url 'project:update' project.pk %}">
                        <i class="bi bi-pencil"></i>
                    </a>
                    <span  class="fw-bold">Période d'analyse</span>
                    <p>De {{ project.analyse_start_date }} à {{ project.analyse_end_date }}</p>
                </div>

                <div class="box p-4 mt-1">
                    <span  class="fw-bold">Millésimes OCSGE utilisés</span>
                    <p>Le plus ancien : {{ project.first_year_ocsge|stringformat:"i" }}
                    <br/>Le plus récent : {{ project.last_year_ocsge|stringformat:"i" }}</p>
                </div>

                <div class="box p-4 mt-1">
                    <span  class="fw-bold">Analyses disponibles</span>
                    <br/><i class="bi bi-check-circle text-success"></i> Consomation d'espace
                    <br/>
                    {% if analysis_artif %}
                        <i class="bi bi-check-circle text-success"></i>
                    {% else %}
                        <i class="bi bi-x-circle text-danger"></i>
                    {% endif %}
                    Artificialisation
                </div>

                <div class="box p-4 mt-1 flex-grow-1">
                    <div  class="fw-bold">
                        <a class="float-end" href="{% url 'project:lookalike' project.id %}">
                            <i class="bi bi-plus-circle"></i>
                        </a>
                        Territoires de comparaison
                    </div>
                    {% if project.look_a_like %}
                        <div class="d-flex flex-column mt-2">
                        {% for land in project.get_look_a_like %}
                            <div class="w100">
                                {{ land.name }}
                                <a href="{% url 'project:lookalike' project.id %}?remove={{ land.public_key }}" class="float-end"><i class="bi bi-trash text-danger"></i></a>
                            </div>
                        {% endfor %}
                        </div>
                    {% else %}
                    <p class="text-muted">Aucun territoire.</p>
                    {% endif %}
                </div>

            </div>
            <div class="col-7 d-flex">

                <div class="box p-4 flex-grow-1">
                    <a class="float-end" href="{% url 'project:update' project.pk %}">
                        <i class="bi bi-pencil"></i>
                    </a>
                    <span  class="fw-bold">Description</span>
                    {% if project.description %}
                        <p>{{ project.description }}</p>
                    {% else %}
                        <p class="text-muted">Aucune description.</p>
                    {% endif %}
                </div>

            </div>
        </div>

    </div> -->
<!-- </div> -->
{% endblock %}

{% block tagging %}
<script language="javascript" nonce="{{ CSP_NONCE }}">
$( window ).on('load', function () {
    _paq.push(['trackEvent', 'Consultation diagnostic', 'Home page'])
})
</script>
{% endblock tagging %}
