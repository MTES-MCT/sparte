{% extends 'index.html' %}

{% load static %}
{% load project_tags %}
{% load humanize %}
{% load i18n %}
{% load l10n %}
{% load sri %}

{% block pagetitle %}
Synthèse
{% endblock %}

{% block headers %}
{% sri_static "project/css/project.css" %}
{% endblock %}

{% block content %}
<div class="px-4">
    {% include "project/partials/report_title.html" with title=diagnostic surface=diagnostic.area %}

    {% include "project/detail_menu.html" %}

    <div class="fr-container fr-py-3w">
      {% include "project/partials/report_informations.html" with content=information_synthesis_1 id="synthesis_1" %}

      {% if not ocsge_available %}
      <div class="fr-notice fr-notice--info">
        <div class="fr-container">
            <div class="fr-notice__body">
                <p class="fr-notice__title">Les données OCS GE ne sont pas encore disponibles sur ce territoire, vous n’avez donc pas accès aux informations relatives à l’artificialisation, l’usage et la couverture.</p>
            </div>
        </div>
      </div>
      {% endif %}

      <div class="mt-5">
        <h2>Consommation</h2>
        <h3>Bilan de la consommation d'espace</h3>
        <div class="fr-grid-row fr-grid-row--gutters">
          <div class="fr-col-12 fr-col-md-6 fr-grid-row">
            <div class="fr-callout w-100">
              <p class="fr-callout__title">+{{ current_conso|floatformat:1 }} ha</p>
              <p>Consommation d'espace {{ diagnostic.analyse_start_date }}-{{ diagnostic.analyse_end_date }}</p>
            </div>
          </div>
          <div class="fr-col-12 fr-col-md-6 fr-grid-row">
            <div class="fr-callout w-100">
              <p class="fr-callout__title">+{{ objective_chart.conso_2031|floatformat:1 }} ha</p>
              <p>Consommation d'espace totale recommandée pour 2021-2031 sur la base d'une réduction de {{ diagnostic.target_2031 }}%</p>
            </div>
          </div>
        </div>
        <div>
          <a class="fr-link" href="{% url 'project:report_conso' diagnostic.pk %}">Consulter le bilan de consommation d'espace</a>
        </div>
      </div>

      {% if ocsge_available %}
      <div class="mt-5">
        <h2>Artificialisation</h2>
        <h3>Bilan de l'artificialisation nette entre {{ diagnostic.analyse_start_date }} et {{ diagnostic.analyse_end_date }}</h3>
        {% if ocsge_available %}
          <p>Sur la période demandée, l'OCS GE couvre de {{ first_millesime }} à {{ last_millesime }}.</p>
        {% endif %}
        <div class="fr-grid-row fr-grid-row--gutters">
          <div class="fr-col-12 fr-col-md-6 fr-grid-row">
            <div class="fr-callout w-100">
              <p class="fr-callout__title">{{ net_artif|floatformat:0 }} ha</p>
              <p>Artificialisation nette</p>
            </div>
          </div>
          <div class="fr-col-12 fr-col-md-6 fr-grid-row">
            <div class="fr-callout w-100">
              <p class="fr-callout__title">+{{ new_natural|floatformat:0 }} ha</p>
              <p>Renaturation</p>
            </div>
          </div>
        </div>
        <div>
          <a class="fr-link" href="{% url 'project:report_artif' project.pk %}">Consulter le bilan de l'artificialisation</a>
        </div>
      </div>
      {% endif %}
    </div>
</div>
{% endblock %}

{% block tagging %}
<script language="javascript" nonce="{{ CSP_NONCE }}">
$( window ).on('load', function () {
    _paq.push(['trackEvent', 'Consultation diagnostic', 'Tableau de bord', 'Synthèse'])
})

var fired = false
$( window ).scroll(function() {
    if(fired == false && $( window ).scrollTop() + $( window ).height() > $( "#block-content" ).height() - 100) {
        _paq.push(['trackEvent', 'Consultation diagnostic', 'Fin tableau de bord', 'Synthèse'])
        fired = true
    }
})
</script>
{% endblock tagging %}
