{% extends 'index.html' %}

{% load static %}
{% load project_tags %}
{% load humanize %}
{% load i18n %}
{% load l10n %}

{% block pagetitle %}
Rapport couverture du sol
{% endblock %}

{% block headers %}
<link href="{% static 'project/css/project.css' %}" rel="stylesheet" />
{% endblock %}

{% block content %}
<div class="px-4">
    {% include "project/detail_menu.html" %}

    <div class="bg-light p-5 rounded-5 border">

        <div class="box box-alert px-4 py-2 mb-4 mt-0">
            L’article 192 de la Loi Climat & Résilience votée en août 2021 la définit comme « une surface dont les sols sont :
            <ul>
                <li>soit imperméabilisés en raison du bâti ou d'un revêtement,</li>
                <li>soit stabilisés et compactés,</li>
                <li>soit constitués de matériaux composites »</li>
            </ul>
            Elle se traduit dans l’OCSGE nationale comme la somme des objets anthropisés dans la description de la couverture des sols
        </div>

        <div class="clearfix">
            <div class="card key-figure">
                <div class="card-header">
                    Territoire total
                </div>
                <div class="card-body">
                    <p class="figure">{{ total_surface }} ha</p>
                </div>
            </div>

            <div class="card key-figure key-figure-yellow">
                <div class="card-header">
                    Progression
                </div>
                <div class="card-body">
                    <p class="figure">XYZ ha</p>
                    <p class="card-text"><small class="text-muted">
                        aa% du territoire
                    </small></p>
                </div>
            </div>
        </div>


        <div class="w-100 box p-4">
            <h3>Répartition</h3>
            <div class="row">
                <div class="col-4 border-end">
                    <div id="chart_2"></div>
                </div>
                <div class="col-4 border-end">
                    <div id="chart_3"></div>
                </div>
                <div class="col-4">
                    <div id="chart_1"></div>
                </div>
            </div>

        </div>

        <div class="box scrollme-x p-4 table table-responsive">
            <h3>Progression de la couverture du sol-artificialisation de 2015 à 2018 :</h3>
            <table class="table table-striped table-sm">
                <thead>
                    <tr>
                        <th scope="col">Code</th>
                        <th scope="col">Libellé</th>
                        <th scope="col" style="text-align: right">Surface 2015 (km²)</th>
                        <th scope="col" style="text-align: right">Progression</th>
                        <th scope="col" style="text-align: right">Surface 2018 (km²)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for data in data_covers %}
                    <tr {% if data.level == 2 %}class="fw-bold"{% endif %}>
                        <th scope="row">{{ data.level|space }} {{ data.code }}</th>
                        <td>{{ data.label_short }}</td>
                        <td align="right">{{ data.get_surface_2015|floatformat:1 }}</td>
                        <td align="right">
                            {% if data.evolution > 0 %}+{% endif%}{{ data.evolution|floatformat:2 }}
                        </td>
                        <td align="right">{{ data.get_surface_2018|floatformat:1 }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="box scrollme-x p-4 table table-responsive">
            <h3>Répartition de la couverture du sol en 2018 :</h3>
            <table class="table table-striped table-sm">
                <thead>
                    <tr>
                        <th scope="col">Code</th>
                        <th scope="col">Libellé</th>
                        <th scope="col" style="text-align: right">Surface 2018 (km²)</th>
                        <th scope="col" style="text-align: right">Pourcentage</th>
                    </tr>
                </thead>
                <tbody>
                    {% for data in data_covers %}
                        <tr {% if data.level == 2 %}class="fw-bold"{% endif %}>
                            <th scope="row">{{ data.level|space }} {{ data.code }}</th>
                            <td>{{ data.label_short }}</td>
                            <td align="right">{{ data.get_surface_2018|floatformat:2 }}</td>
                            <td align="right">
                                {{ data.get_surface_2018|percent:surface_territoire }}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>


        <div class="box px-4 py-2">
            <p>Sources:</p>
            <ul>
                <li><a href="{% url 'public_data:ocsge-list' %}?limit=2"></a>Données OCS GE</a></li>
            </ul>
        </div>
    </div>
</div>
{% endblock %}

{% block bodyend %}
{% localize off %}
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/drilldown.js"></script>
<script language="javascript">
Highcharts.chart('chart_2', {
    chart: {
        type: 'pie'
    },
    title: {
        text: "2015",
        floating: true,
    },
    tooltip: {
        valueSuffix: ' Ha',
        valueDecimals: 0,
    },
    plotOptions:{
    	pie:
        {
            innerSize: '60%',
        },
    },
    series: [{
        name: '2015',
        data: [{% for data in data_covers %}
            {% if data.level == 2 %}
                {
                    name: "{{ data.name }}",
                    y: {{ data.get_surface_2015 }},
                    color: '{{ data.map_color }}',
                },
            {% endif %}
        {% endfor %}],
    }]
})

Highcharts.chart('chart_3', {
    chart: {
        type: 'pie'
    },
    title: {
        text: "2018",
        floating: true,
    },
    tooltip: {
        valueSuffix: ' Ha',
        valueDecimals: 0,
    },
    plotOptions:{
    	pie:
        {
            innerSize: '60%',
        },
    },
    series: [
        {
            name: '2018',
            data: [{% for data in data_covers %}
                {% if data.level == 2 %}
                    {
                        name: "{{ data.name }}",
                        y: {{ data.get_surface_2018 }},
                        color: '{{ data.map_color }}',
                    },
                {% endif %}
            {% endfor %}],
        },
    ]
})


Highcharts.chart('chart_1', {
    chart: {
        type: 'column'
    },
    title: {
        text: "Progression",
    },
    tooltip: {
        valueSuffix: ' Ha',
        valueDecimals: 2,
        headerFormat: '',
        pointFormat: '{point.name}: {point.y}'
    },
    plotOptions:{
    },
    xAxis: {
        type: 'category',
    },
    yAxis: [{
        title: {
            text: 'Surface'
        },
        plotLines: [{
            value: 0,
            width: 2,
            color: '#ff0000'
        }],
    }],
    legend: {
        enabled: false,
    },
    series: [
        {
            name: 'Evolution',
            data: [{% for data in data_covers %}
                {% if data.level == 2 %}
                    {
                        name: "{{ data.name }}",
                        y: {{ data.evolution }},
                        color: '{{ data.map_color }}',
                    },
                {% endif %}
            {% endfor %}],
        },
    ]
})
</script>
{% endlocalize %}
{% endblock %}
