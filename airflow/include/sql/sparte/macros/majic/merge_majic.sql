{% macro merge_majic(final_commune_code, communes_code_to_merge) %}
SELECT
        min('{{ final_commune_code }}') as commune_code,
        sum(conso_2009) as conso_2009,
        sum(conso_2009_activite) as conso_2009_activite,
        sum(conso_2009_habitat) as conso_2009_habitat,
        sum(conso_2009_mixte) as conso_2009_mixte,
        sum(conso_2009_route) as conso_2009_route,
        sum(conso_2009_ferroviaire) as conso_2009_ferroviaire,
        sum(conso_2009_inconnu) as conso_2009_inconnu,
        sum(conso_2010) as conso_2010,
        sum(conso_2010_activite) as conso_2010_activite,
        sum(conso_2010_habitat) as conso_2010_habitat,
        sum(conso_2010_mixte) as conso_2010_mixte,
        sum(conso_2010_route) as conso_2010_route,
        sum(conso_2010_ferroviaire) as conso_2010_ferroviaire,
        sum(conso_2010_inconnu) as conso_2010_inconnu,
        sum(conso_2011) as conso_2011,
        sum(conso_2011_activite) as conso_2011_activite,
        sum(conso_2011_habitat) as conso_2011_habitat,
        sum(conso_2011_mixte) as conso_2011_mixte,
        sum(conso_2011_route) as conso_2011_route,
        sum(conso_2011_ferroviaire) as conso_2011_ferroviaire,
        sum(conso_2011_inconnu) as conso_2011_inconnu,
        sum(conso_2012) as conso_2012,
        sum(conso_2012_activite) as conso_2012_activite,
        sum(conso_2012_habitat) as conso_2012_habitat,
        sum(conso_2012_mixte) as conso_2012_mixte,
        sum(conso_2012_route) as conso_2012_route,
        sum(conso_2012_ferroviaire) as conso_2012_ferroviaire,
        sum(conso_2012_inconnu) as conso_2012_inconnu,
        sum(conso_2013) as conso_2013,
        sum(conso_2013_activite) as conso_2013_activite,
        sum(conso_2013_habitat) as conso_2013_habitat,
        sum(conso_2013_mixte) as conso_2013_mixte,
        sum(conso_2013_route) as conso_2013_route,
        sum(conso_2013_ferroviaire) as conso_2013_ferroviaire,
        sum(conso_2013_inconnu) as conso_2013_inconnu,
        sum(conso_2014) as conso_2014,
        sum(conso_2014_activite) as conso_2014_activite,
        sum(conso_2014_habitat) as conso_2014_habitat,
        sum(conso_2014_mixte) as conso_2014_mixte,
        sum(conso_2014_route) as conso_2014_route,
        sum(conso_2014_ferroviaire) as conso_2014_ferroviaire,
        sum(conso_2014_inconnu) as conso_2014_inconnu,
        sum(conso_2015) as conso_2015,
        sum(conso_2015_activite) as conso_2015_activite,
        sum(conso_2015_habitat) as conso_2015_habitat,
        sum(conso_2015_mixte) as conso_2015_mixte,
        sum(conso_2015_route) as conso_2015_route,
        sum(conso_2015_ferroviaire) as conso_2015_ferroviaire,
        sum(conso_2015_inconnu) as conso_2015_inconnu,
        sum(conso_2016) as conso_2016,
        sum(conso_2016_activite) as conso_2016_activite,
        sum(conso_2016_habitat) as conso_2016_habitat,
        sum(conso_2016_mixte) as conso_2016_mixte,
        sum(conso_2016_route) as conso_2016_route,
        sum(conso_2016_ferroviaire) as conso_2016_ferroviaire,
        sum(conso_2016_inconnu) as conso_2016_inconnu,
        sum(conso_2017) as conso_2017,
        sum(conso_2017_activite) as conso_2017_activite,
        sum(conso_2017_habitat) as conso_2017_habitat,
        sum(conso_2017_mixte) as conso_2017_mixte,
        sum(conso_2017_route) as conso_2017_route,
        sum(conso_2017_ferroviaire) as conso_2017_ferroviaire,
        sum(conso_2017_inconnu) as conso_2017_inconnu,
        sum(conso_2018) as conso_2018,
        sum(conso_2018_activite) as conso_2018_activite,
        sum(conso_2018_habitat) as conso_2018_habitat,
        sum(conso_2018_mixte) as conso_2018_mixte,
        sum(conso_2018_route) as conso_2018_route,
        sum(conso_2018_ferroviaire) as conso_2018_ferroviaire,
        sum(conso_2018_inconnu) as conso_2018_inconnu,
        sum(conso_2019) as conso_2019,
        sum(conso_2019_activite) as conso_2019_activite,
        sum(conso_2019_habitat) as conso_2019_habitat,
        sum(conso_2019_mixte) as conso_2019_mixte,
        sum(conso_2019_route) as conso_2019_route,
        sum(conso_2019_ferroviaire) as conso_2019_ferroviaire,
        sum(conso_2019_inconnu) as conso_2019_inconnu,
        sum(conso_2020) as conso_2020,
        sum(conso_2020_activite) as conso_2020_activite,
        sum(conso_2020_habitat) as conso_2020_habitat,
        sum(conso_2020_mixte) as conso_2020_mixte,
        sum(conso_2020_route) as conso_2020_route,
        sum(conso_2020_ferroviaire) as conso_2020_ferroviaire,
        sum(conso_2020_inconnu) as conso_2020_inconnu,
        sum(conso_2021) as conso_2021,
        sum(conso_2021_activite) as conso_2021_activite,
        sum(conso_2021_habitat) as conso_2021_habitat,
        sum(conso_2021_mixte) as conso_2021_mixte,
        sum(conso_2021_route) as conso_2021_route,
        sum(conso_2021_ferroviaire) as conso_2021_ferroviaire,
        sum(conso_2021_inconnu) as conso_2021_inconnu,
        sum(conso_2022) as conso_2022,
        sum(conso_2022_activite) as conso_2022_activite,
        sum(conso_2022_habitat) as conso_2022_habitat,
        sum(conso_2022_mixte) as conso_2022_mixte,
        sum(conso_2022_route) as conso_2022_route,
        sum(conso_2022_ferroviaire) as conso_2022_ferroviaire,
        sum(conso_2022_inconnu) as conso_2022_inconnu,
        sum(conso_2009_2023) as conso_2009_2023,
        sum(conso_2009_2023_activite) as conso_2009_2023_activite,
        sum(conso_2009_2023_habitat) as conso_2009_2023_habitat,
        sum(conso_2009_2023_mixte) as conso_2009_2023_mixte,
        sum(conso_2009_2023_route) as conso_2009_2023_route,
        sum(conso_2009_2023_ferroviaire) as conso_2009_2023_ferroviaire,
        sum(conso_2009_2023_inconnu) as conso_2009_2023_inconnu
FROM
    {{ ref('consommation') }}
WHERE
    commune_code in (
        '{{ final_commune_code }}',
        {% for commune_code in communes_code_to_merge %}
            '{{ commune_code }}'
            {% if not loop.last %},{% endif %}
        {% endfor %}
    )
{% endmacro %}
